<?xml version="1.0" encoding="UTF-8" ?>
<!DOCTYPE mapper
  PUBLIC "-//mybatis.org//DTD Mapper 3.0//EN"
  "https://mybatis.org/dtd/mybatis-3-mapper.dtd">

<mapper namespace="planReceive">
	<!-- 등록 -->
	<insert id="add">
		insert into plan_receive(
			plan_receive_no, plan_receive_receiver_no, plan_receive_is_accept
		)
		values(
			#{planReceiveNo}, #{planReceiveReceiverNo}, #{planReceiveIsAccept}
		)
	</insert>
	
	<!-- 삭제 -->
	<delete id="delete">
		delete plan_receive 
		where plan_receive_no = #{planReceiveNo}
	</delete>
	
	<!-- 전체 조회(일정) -->
	<select id="list" resultType="PlanReceiveDto">
		select * from plan_receive
		where plan_receive_receiver_no = #{planReceiveReceiverNo}
		order by plan_receive_no desc
	</select>
	
	<!-- 목록 조회(일정에 포함된 수신자 목록) -->
	<select id="listReceiver" resultType="long">
		select plan_receive_receiver_no
		from plan_receive
		where plan_receive_no = #{planNo}
	</select>

	<!-- 상세 조회 -->
	<select id="detail" resultType="PlanReceiveDto">
		select * from plan_receive 
		where plan_receive_no = #{planReceiveNo}
	</select>
	
	<!-- 일정 + 보낸사람 이름 + 수신자 상태 조회 -->
	<!-- (참고)join : 두 개 이상의 테이블을 공통된 키로 연결해서 정보를 합치는 것 -->
	<select id="listReceived" resultType="PlanReceiveResponseVO">
		select
		    plan_receive_no,
		    plan_title,
		    plan_start_time,
		    plan_end_time,
		    member_name,
		    plan_receive_is_accept
		from plan_receive pr
		join plan p on pr.plan_receive_no = p.plan_no
		join member m on p.plan_sender_no = m.member_no
		where pr.plan_receive_receiver_no = #{memberNo}
		order by p.plan_start_time asc
	</select>
	
	<!-- 일정 수락 -->
	<update id="accept">
		update plan_receive
		set plan_receive_is_accept = 'Y' 
		where plan_receive_no = #{planReceiverNo} 
		and plan_receive_receiver_no = #{planReceiveReceiverNo}
	</update>
	
	<!-- 수락한 일정 조회 -->
	<select id="listAccepted" resultType="PlanReceiveResponseVO">
		select
			plan_receive_no,
			plan_title,
			plan_start_time,
			plan_end_time,
			member_name,
			plan_receive_is_accept
		from plan_receive pr
		join plan p on pr.plan_receive_no = p.plan_no
		join member m on p.plan_sender_no = m.member_no
		where pr.plan_receive_receiver_no = #{memberNo}
		and pr.plan_receive_is_accept = 'Y'
		order by p.plan_start_time asc
	</select>
	
</mapper>